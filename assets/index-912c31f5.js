import{r as v,a as Fe,R as Re}from"./vendor-b1791c80.js";(function(){const m=document.createElement("link").relList;if(m&&m.supports&&m.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))x(a);new MutationObserver(a=>{for(const c of a)if(c.type==="childList")for(const d of c.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&x(d)}).observe(document,{childList:!0,subtree:!0});function N(a){const c={};return a.integrity&&(c.integrity=a.integrity),a.referrerPolicy&&(c.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?c.credentials="include":a.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function x(a){if(a.ep)return;a.ep=!0;const c=N(a);fetch(a.href,c)}})();var pe={exports:{}},ee={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var De=v,Ee=Symbol.for("react.element"),$e=Symbol.for("react.fragment"),Ie=Object.prototype.hasOwnProperty,ke=De.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Be={key:!0,ref:!0,__self:!0,__source:!0};function ge(t,m,N){var x,a={},c=null,d=null;N!==void 0&&(c=""+N),m.key!==void 0&&(c=""+m.key),m.ref!==void 0&&(d=m.ref);for(x in m)Ie.call(m,x)&&!Be.hasOwnProperty(x)&&(a[x]=m[x]);if(t&&t.defaultProps)for(x in m=t.defaultProps,m)a[x]===void 0&&(a[x]=m[x]);return{$$typeof:Ee,type:t,key:c,ref:d,props:a,_owner:ke.current}}ee.Fragment=$e;ee.jsx=ge;ee.jsxs=ge;pe.exports=ee;var e=pe.exports,ne={},xe=Fe;ne.createRoot=xe.createRoot,ne.hydrateRoot=xe.hydrateRoot;const Le="_pitCard_wvxdv_1",Te="_selected_wvxdv_19",Ke="_empty_wvxdv_24",Ae="_pitHeader_wvxdv_34",We="_pitNumber_wvxdv_41",Ge="_pitDate_wvxdv_47",Pe="_checkbox_wvxdv_52",Oe="_pitContent_wvxdv_63",Ve="_pitRow_wvxdv_70",He="_pitCorner_wvxdv_76",S={pitCard:Le,selected:Te,empty:Ke,pitHeader:Ae,pitNumber:We,pitDate:Ge,checkbox:Pe,pitContent:Oe,pitRow:Ve,pitCorner:He},ae=({pit:t,isSelected:m,onSelect:N,onEdit:x,mode:a="view"})=>{const c=()=>!t.W||!t.Kл||t.силос===null?"var(--color-empty)":t.силос===1?"var(--color-silo-1)":t.силос===2?"var(--color-silo-2)":t.силос===3?parseFloat(t.Kл)>23?"var(--color-silo-3-high)":"var(--color-silo-3-low)":"var(--color-empty)",d=(_,l,o="")=>l==null||l===""?"":`${_} ${l}${o}`,p=()=>{a==="select"?x(t):a==="view"&&t.W&&t.Kл&&t.силос!==null&&N(t)};return e.jsxs("div",{className:`${S.pitCard} ${m?S.selected:""} ${(!t.W||!t.Kл||t.силос===null)&&a==="view"?S.empty:""}`,style:{backgroundColor:c()},onClick:p,children:[e.jsxs("div",{className:S.pitHeader,children:[e.jsx("span",{className:S.pitNumber,children:t.id}),e.jsx("span",{className:S.pitDate,children:t.дата}),a==="view"&&e.jsx("input",{type:"checkbox",checked:m,onChange:()=>{},onClick:_=>{_.stopPropagation(),t.W&&t.Kл&&t.силос!==null&&N(t)},disabled:!t.W||!t.Kл||t.силос===null,className:S.checkbox})]}),e.jsxs("div",{className:S.pitContent,children:[e.jsx("div",{className:S.pitRow,children:d("W = ",t.W,"%")}),e.jsx("div",{className:S.pitRow,children:d("ЧП = ",t.ЧП,"с")}),e.jsxs("div",{className:S.pitRow,children:[d("Kл = ",t.Kл,"%")," -"," ",d("",t.ВДК,"од.")]}),e.jsx("div",{className:S.pitRow,children:d("m = ",t.m,"т")})]}),t.силос&&e.jsxs("div",{className:S.pitCorner,children:[t.силос,"с"]})]})},Ue="_calculator_1me1b_1",ze="_header_1me1b_8",Je="_modeBtn_1me1b_21",qe="_filtersRow_1me1b_40",Ye="_componentFilter_1me1b_49",Xe="_resultsFilter_1me1b_50",Ze="_filterSelect_1me1b_64",Qe="_topResultsContainer_1me1b_80",et="_topResultsTitle_1me1b_116",tt="_topResultItem_1me1b_123",st="_selectedResult_1me1b_138",nt="_resultHeader_1me1b_143",at="_resultNumber_1me1b_150",lt="_componentCount_1me1b_156",ot="_resultData_1me1b_165",rt="_resultMix_1me1b_171",ct="_errorValue_1me1b_177",it="_errorPulse_1me1b_1",dt="_resultPercentages_1me1b_222",mt="_modeLabel_1me1b_234",ut="_disabledBtn_1me1b_247",ht="_controlTable_1me1b_262",xt="_backBtn_1me1b_269",_t="_glutenRow_1me1b_289",pt="_mixResult_1me1b_299",gt="_mixGrid_1me1b_310",ft="_mixItem_1me1b_317",vt="_mixLabel_1me1b_332",bt="_mixValue_1me1b_337",jt="_glutenLabel_1me1b_368",Nt="_glutenValue_1me1b_374",wt="_pitControlRow_1me1b_381",Ct="_pitId_1me1b_395",yt="_controlBtn_1me1b_401",St="_percentageValue_1me1b_426",Mt="_percentageFixed_1me1b_436",Ft="_pitData_1me1b_444",Rt="_mixDisplay_1me1b_452",Dt="_mixInfo_1me1b_460",Et="_pitsGrid_1me1b_468",$t="_pitContainer_1me1b_475",n={calculator:Ue,header:ze,modeBtn:Je,filtersRow:qe,componentFilter:Ye,resultsFilter:Xe,filterSelect:Ze,topResultsContainer:Qe,topResultsTitle:et,topResultItem:tt,selectedResult:st,resultHeader:nt,resultNumber:at,componentCount:lt,resultData:ot,resultMix:rt,errorValue:ct,errorPulse:it,resultPercentages:dt,modeLabel:mt,disabledBtn:ut,controlTable:ht,backBtn:xt,glutenRow:_t,mixResult:pt,mixGrid:gt,mixItem:ft,mixLabel:vt,mixValue:bt,glutenLabel:jt,glutenValue:Nt,pitControlRow:wt,pitId:Ct,controlBtn:yt,percentageValue:St,percentageFixed:Mt,pitData:Ft,mixDisplay:Rt,mixInfo:Dt,pitsGrid:Et,pitContainer:$t},It=({selectedPits:t,onBack:m,allPits:N,onPitSelect:x})=>{const[a,c]=v.useState(null),[d,p]=v.useState({}),[_,l]=v.useState({}),[o,C]=v.useState(!0),[D,U]=v.useState(null),[K,w]=v.useState("best"),[b,E]=v.useState(!1),[M,$]=v.useState([]),[fe,q]=v.useState(0);v.useEffect(()=>{const s=localStorage.getItem("labcalc_target_gluten");if(s){const u=parseFloat(s);isNaN(u)||U(u)}},[]),v.useEffect(()=>{t.length===1?(b&&q(0),p({[t[0].id]:100}),l(t[0]),c(parseFloat(t[0].Kл)),$([])):t.length>=2&&(t.length===0&&D&&!a&&c(D),o?ve():be())},[t,o,K,D,b]);const ve=()=>{const s=t.map(y=>parseFloat(y.Kл)).filter(y=>!isNaN(y)),u=Math.min(...s),f=Math.max(...s),h=D||(s.length>0?(u+f)/2:22);c(Math.round(h*10)/10);const r=le(h,t);b&&r.alternatives&&r.alternatives.length>0?($(r.alternatives),q(0),p(r.alternatives[0].percentages),l(r.alternatives[0].mixData)):(p(r.percentages||r),Y(r.percentages||r),$([]))},be=()=>{const s={},u=Math.floor(100/t.length/10)*10;let f=100;t.forEach((h,r)=>{if(r===t.length-1)s[h.id]=Math.max(0,f);else{const y=Math.max(0,u);s[h.id]=y,f-=y}}),p(s),Y(s),oe(s)},le=(s,u)=>{if(u.length<2)return{};const f=350;if(u.length===2){const[i,g]=u,I=parseFloat(i.Kл),z=parseFloat(g.Kл);if(Math.abs(I-z)<.01)return{[i.id]:50,[g.id]:50};const R=(s-z)/(I-z)*100,G=100-R;return{[i.id]:Math.max(0,Math.min(100,Math.round(R/10)*10)),[g.id]:Math.max(0,Math.min(100,Math.round(G/10)*10))}}console.log(`Оптимізація для цільової клейковини: ${s}%, цільове число падіння: ${f}с`),console.log(`Фільтр компонентів: ${K}`),console.log("Ями:",u.map(i=>`${i.id}(Kл:${i.Kл}%, ЧП:${i.ЧП}с)`));let h=[],r=1/0;const y=i=>Object.values(i).filter(g=>g>0).length,A=i=>{const g=y(i);switch(K){case"2-comp":return g===2;case"3-comp":return g===3;case"multi-comp":return g>=4;case"best":default:return!0}},F=(i,g,I)=>{if(i>=u.length){if(I===0){if(!A(g))return;const R=y(g);if(R<2)return;let G=0,B=0,L=0,X=0,Z=1/0,P=0;if(u.forEach(O=>{const ue=g[O.id];if(ue>0){const V=ue/100;G+=parseFloat(O.W||0)*V,B+=parseFloat(O.ЧП||0)*V,L+=parseFloat(O.Kл||0)*V,X+=parseFloat(O.ВДК||0)*V;const he=parseFloat(O.m||0)/V;he>0&&(Z=Math.min(Z,he)),P+=V}}),P===0)return;G=G/P,B=B/P,L=L/P,X=X/P;const J=Math.abs(L-s),de=Math.abs(B-f),me={W:Math.round(G*10)/10,ЧП:Math.round(B),Kл:Math.round(L*10)/10,ВДК:Math.round(X),m:Z===1/0?0:Math.round(Z*10)/10};J<r-.049?(r=J,h=[{percentages:{...g},glutenError:J,fallingNumberError:de,mixGluten:L,mixFallingNumber:B,mixData:me,componentCount:R}]):Math.abs(J-r)<=.049&&h.push({percentages:{...g},glutenError:J,fallingNumberError:de,mixGluten:L,mixFallingNumber:B,mixData:me,componentCount:R})}return}const z=u[i];for(let R=0;R<=Math.min(100,I);R+=10)g[z.id]=R,F(i+1,g,I-R)};console.log("Початок повного перебору комбінацій...");const W=Date.now();F(0,{},100);const k=Date.now();if(console.log(`Перебір завершено за ${k-W}мс`),h.length===0)return console.log("Не знайдено валідних комбінацій, використовуємо запасний варіант"),{percentages:u.reduce((i,g,I)=>(i[g.id]=I===0?100:0,i),{})};if(h.sort((i,g)=>i.fallingNumberError-g.fallingNumberError),console.log(`Знайдено ${h.length} комбінацій з помилкою клейковини ≤ ${r.toFixed(3)}`),b){const i=h.slice(0,10);return console.log("Топ 10 результатів:"),i.forEach((g,I)=>{console.log(`${I+1}. ${g.componentCount}-комп: Kл:${g.mixGluten.toFixed(1)}% ЧП:${g.mixFallingNumber.toFixed(0)}с W:${g.mixData.W}% m:${g.mixData.m}т`),console.log(`   Відсотки: ${JSON.stringify(g.percentages)}`)}),{percentages:i[0].percentages,alternatives:i}}else{const i=h[0];return console.log("Обрана найкраща комбінація:"),console.log(`  ${i.componentCount}-компонентна суміш`),console.log(`  Клейковина: ${i.mixGluten.toFixed(1)}% (помилка: ${i.glutenError.toFixed(3)})`),console.log(`  Число падіння: ${i.mixFallingNumber.toFixed(0)}с (помилка: ${i.fallingNumberError.toFixed(1)})`),console.log("  Повні дані суміші:",i.mixData),console.log("  Відсотки:",i.percentages),{percentages:i.percentages}}},Y=s=>{if(Object.values(s).reduce((F,W)=>F+(W||0),0)===0)return;let f=0,h=0,r=0,y=0,A=1/0;t.forEach(F=>{const W=s[F.id]||0;if(W>0){const k=W/100;f+=parseFloat(F.W||0)*k,h+=parseFloat(F.ЧП||0)*k,r+=parseFloat(F.Kл||0)*k,y+=parseFloat(F.ВДК||0)*k;const i=parseFloat(F.m||0)/k;i>0&&(A=Math.min(A,i))}}),l({W:Math.round(f*10)/10,ЧП:Math.round(h),Kл:Math.round(r*10)/10,ВДК:Math.round(y),m:A===1/0?0:Math.round(A*10)/10})},oe=s=>{let u=0,f=0;if(t.forEach(h=>{const r=s[h.id]||0;r>0&&(u+=parseFloat(h.Kл||0)*(r/100),f+=r/100)}),f>0){const h=u/f;c(Math.round(h*10)/10)}},re=s=>{if(t.length<2)return;const u=t.map(y=>parseFloat(y.Kл));Math.min(...u),Math.max(...u);const f=a+s,h=Math.round(f*10)/10;c(h),U(h),localStorage.setItem("labcalc_target_gluten",h.toString());const r=le(h,t);b&&r.alternatives&&r.alternatives.length>0?($(r.alternatives),q(0),p(r.alternatives[0].percentages),l(r.alternatives[0].mixData)):(p(r.percentages||r),Y(r.percentages||r))},ce=(s,u)=>{const f={...d};let r=(f[s]||0)+u;r=Math.max(0,Math.min(100,Math.round(r/10)*10)),f[s]=r,p(f),Y(f),oe(f)},je=()=>{C(!o)},Ne=()=>o&&t.length>=2,we=()=>o&&t.length>=2,Ce=s=>!o&&(d[s]||0)>0,ye=s=>!o&&(d[s]||0)<100,te=()=>Object.values(d).reduce((s,u)=>s+(u||0),0),ie=()=>!o&&te()>100||!o&&te()<100,Se=()=>!_.Kл||!a?0:Math.abs(_.Kл-a),Me=()=>o&&Se()>.5;return t.length>=2,t.length>=2,e.jsxs("div",{className:n.calculator,children:[e.jsxs("div",{className:n.header,children:[e.jsx("button",{onClick:m,className:n.backBtn,children:"←"}),e.jsx("h2",{children:"LAB Calc"}),e.jsx("button",{onClick:je,className:n.modeBtn,children:o?"🤖 AUTO":"✋ HAND"})]}),e.jsxs("div",{className:n.controlTable,children:[e.jsxs("div",{className:n.glutenRow,children:[e.jsx("span",{className:n.glutenLabel,children:"Кл"}),o?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>re(-.1),className:n.controlBtn,disabled:!Ne(),children:"-"}),e.jsxs("span",{className:`${n.glutenValue} ${Me()?n.errorValue:""}`,children:[(a==null?void 0:a.toFixed(1))||"0.0","%"]}),e.jsx("button",{onClick:()=>re(.1),className:n.controlBtn,disabled:!we(),children:"+"})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:n.disabledBtn,children:"-"}),e.jsxs("span",{className:n.glutenValue,children:[(a==null?void 0:a.toFixed(1))||"0.0","%"]}),e.jsx("span",{className:n.disabledBtn,children:"+"})]}),e.jsxs("div",{className:n.modeLabel,children:[o?"АВТО":"РУЧН",!o&&ie()&&e.jsxs("div",{className:n.totalPercentage,children:[te(),"%"]})]})]}),o&&t.length>2&&e.jsxs("div",{className:n.filtersRow,children:[e.jsxs("div",{className:n.componentFilter,children:[e.jsx("label",{children:"Компоненти:"}),e.jsxs("select",{value:K,onChange:s=>w(s.target.value),className:n.filterSelect,children:[e.jsx("option",{value:"best",children:"Найкращий"}),e.jsx("option",{value:"2-comp",children:"2-компонентні"}),e.jsx("option",{value:"3-comp",children:"3-компонентні"}),t.length>3&&e.jsx("option",{value:"multi-comp",children:"Багато-компонентні"})]})]}),e.jsxs("div",{className:n.resultsFilter,children:[e.jsx("label",{children:"Показати:"}),e.jsxs("select",{value:b?"top10":"best",onChange:s=>E(s.target.value==="top10"),className:n.filterSelect,children:[e.jsx("option",{value:"best",children:"Найкращий варіант"}),e.jsx("option",{value:"top10",children:"Топ 10 варіантів"})]})]})]}),e.jsx("div",{className:n.mixInfo,children:e.jsxs("div",{className:n.mixGrid,children:[e.jsxs("div",{className:n.mixItem,children:[e.jsx("span",{className:n.mixLabel,children:"W:"}),e.jsxs("span",{className:n.mixValue,children:[_.W||0,"%"]})]}),e.jsxs("div",{className:n.mixItem,children:[e.jsx("span",{className:n.mixLabel,children:"ЧП:"}),e.jsxs("span",{className:n.mixValue,children:[_.ЧП||0,"с"]})]}),e.jsxs("div",{className:n.mixItem,children:[e.jsx("span",{className:n.mixLabel,children:"Kл:"}),e.jsxs("span",{className:n.mixValue,children:[_.Kл||0,"%"]})]}),e.jsxs("div",{className:n.mixItem,children:[e.jsx("span",{className:n.mixLabel,children:"ВДК:"}),e.jsxs("span",{className:n.mixValue,children:[_.ВДК||0,"од."]})]}),e.jsxs("div",{className:n.mixItem,children:[e.jsx("span",{className:n.mixLabel,children:"m:"}),e.jsxs("span",{className:n.mixValue,children:[_.m||0,"т"]})]})]})}),t.filter(s=>(d[s.id]||0)>0).map(s=>e.jsxs("div",{className:n.pitControlRow,children:[e.jsx("span",{className:n.pitId,children:s.id}),t.length===1?e.jsx("span",{className:n.percentageFixed,children:"100%"}):o?e.jsxs("span",{className:n.percentageFixed,children:[d[s.id]||0,"%"]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>ce(s.id,-10),className:n.controlBtn,disabled:!Ce(s.id),children:"-"}),e.jsxs("span",{className:`${n.percentageValue} ${ie()?n.errorValue:""}`,children:[d[s.id]||0,"%"]}),e.jsx("button",{onClick:()=>ce(s.id,10),className:n.controlBtn,disabled:!ye(s.id),children:"+"})]})]},s.id))]}),o&&b&&M.length>0&&e.jsxs("div",{className:n.topResultsContainer,children:[e.jsxs("h3",{className:n.topResultsTitle,children:["Топ ",Math.min(M.length,10)," варіантів:"]}),M.map((s,u)=>e.jsxs("div",{className:`${n.topResultItem} ${u===fe?n.selectedResult:""}`,onClick:()=>{q(u),p(s.percentages),l(s.mixData)},children:[e.jsxs("div",{className:n.resultHeader,children:[e.jsxs("span",{className:n.resultNumber,children:["#",u+1]}),e.jsxs("span",{className:n.componentCount,children:[s.componentCount,"-комп"]})]}),e.jsxs("div",{className:n.resultData,children:[e.jsxs("div",{className:n.resultMix,children:["W = ",s.mixData.W,"% | ЧП = ",s.mixData.ЧП,"с | Kл ="," ",s.mixData.Kл,"% | m = ",s.mixData.m,"т"]}),e.jsx("div",{className:n.resultPercentages,children:Object.entries(s.percentages).filter(([f,h])=>h>0).map(([f,h])=>`${f} : ${h}%`).join(", ")})]})]},u))]}),e.jsx("div",{className:n.pitsGrid,children:N.map(s=>{const u=t.some(f=>f.id===s.id);return e.jsx("div",{className:n.pitContainer,children:e.jsx(ae,{pit:s,isSelected:u,onSelect:x,mode:"view"})},s.id)})})]})},kt="_modalOverlay_14oyy_1",Bt="_modal_14oyy_1",Lt="_modalHeader_14oyy_64",Tt="_backBtn_14oyy_80",Kt="_formFields_14oyy_100",At="_field_14oyy_107",Wt="_input_14oyy_119",Gt="_select_14oyy_120",Pt="_modalActions_14oyy_137",Ot="_clearBtn_14oyy_144",Vt="_saveBtn_14oyy_160",j={modalOverlay:kt,modal:Bt,modalHeader:Lt,backBtn:Tt,formFields:Kt,field:At,input:Wt,select:Gt,modalActions:Pt,clearBtn:Ot,saveBtn:Vt},Ht=({pit:t,isOpen:m,onClose:N,onSave:x})=>{const[a,c]=v.useState({силос:2,W:15.6,ЧП:360,Kл:22,ВДК:80,m:10,дата:new Date().toLocaleDateString("uk-UA")});v.useEffect(()=>{t&&m&&c({силос:t.силос||2,W:t.W||15.6,ЧП:t.ЧП||360,Kл:t.Kл||22,ВДК:t.ВДК||80,m:t.m||10,дата:t.дата||new Date().toLocaleDateString("uk-UA")})},[t,m]);const d=(l,o)=>{c(C=>({...C,[l]:o}))},p=()=>{const l={...t,...a};x(l),N()},_=()=>{const l={...t,силос:null,W:null,ЧП:null,Kл:null,ВДК:null,m:null};x(l),N()};return!m||!t?null:e.jsx("div",{className:j.modalOverlay,onClick:N,children:e.jsxs("div",{className:j.modal,onClick:l=>l.stopPropagation(),children:[e.jsxs("div",{className:j.modalHeader,children:[e.jsx("button",{onClick:N,className:j.backBtn,children:"←"}),e.jsx("h3",{children:t.id}),e.jsx("div",{})]}),e.jsxs("div",{className:j.formFields,children:[e.jsxs("div",{className:j.field,children:[e.jsx("label",{children:"Силос"}),e.jsxs("select",{value:a.силос||2,onChange:l=>d("силос",parseInt(l.target.value)),className:j.select,children:[e.jsx("option",{value:1,children:"1"}),e.jsx("option",{value:2,children:"2"}),e.jsx("option",{value:3,children:"3"})]})]}),e.jsxs("div",{className:j.field,children:[e.jsx("label",{children:"W"}),e.jsx("input",{type:"number",step:"0.1",value:a.W||"",onChange:l=>d("W",parseFloat(l.target.value)||null),className:j.input})]}),e.jsxs("div",{className:j.field,children:[e.jsx("label",{children:"ЧП"}),e.jsx("input",{type:"number",step:"1",value:a.ЧП||"",onChange:l=>d("ЧП",parseInt(l.target.value)||null),className:j.input})]}),e.jsxs("div",{className:j.field,children:[e.jsx("label",{children:"Kл"}),e.jsx("input",{type:"number",step:"0.1",value:a.Kл||"",onChange:l=>d("Kл",parseFloat(l.target.value)||null),className:j.input})]}),e.jsxs("div",{className:j.field,children:[e.jsx("label",{children:"ВДК"}),e.jsx("input",{type:"number",step:"1",value:a.ВДК||"",onChange:l=>d("ВДК",parseInt(l.target.value)||null),className:j.input})]}),e.jsxs("div",{className:j.field,children:[e.jsx("label",{children:"m"}),e.jsx("input",{type:"number",step:"0.1",value:a.m||"",onChange:l=>d("m",parseFloat(l.target.value)||null),className:j.input})]}),e.jsxs("div",{className:j.field,children:[e.jsx("label",{children:"дата"}),e.jsx("input",{type:"text",value:a.дата||"",onChange:l=>d("дата",l.target.value),className:j.input})]})]}),e.jsxs("div",{className:j.modalActions,children:[e.jsx("button",{onClick:_,className:j.clearBtn,children:"Очистити"}),e.jsx("button",{onClick:p,className:j.saveBtn,children:"Зберегти"})]})]})})},Ut="_selectMode_norxo_1",zt="_header_norxo_7",Jt="_backBtn_norxo_23",qt="_pitsGrid_norxo_43",Q={selectMode:Ut,header:zt,backBtn:Jt,pitsGrid:qt},Yt=({pits:t,onBack:m,onSave:N})=>{const[x,a]=v.useState(null),[c,d]=v.useState(t),p=async o=>{const C=c.map(D=>D.id===o.id?o:D);d(C),await N(C)},_=o=>{a(o)},l=()=>{a(null)};return e.jsxs("div",{className:Q.selectMode,children:[e.jsxs("div",{className:Q.header,children:[e.jsx("button",{onClick:m,className:Q.backBtn,children:"←"}),e.jsx("h2",{children:"Внести зміни"}),e.jsx("div",{})]}),e.jsx("div",{className:Q.pitsGrid,children:c.map(o=>e.jsx(ae,{pit:o,isSelected:!1,onSelect:()=>{},onEdit:_,mode:"select"},o.id))}),e.jsx(Ht,{pit:x,isOpen:!!x,onClose:l,onSave:p})]})},se="https://script.google.com/macros/s/AKfycbyb3E1Nuc9giNSY0zuhu7hcPYGWILYoO7X8X0DWG9DTASEzfIWmKM4JxS4FwzdyGwKS/exec",Xt=()=>{const[t,m]=v.useState(!1),[N,x]=v.useState(null),a=v.useCallback(async()=>{m(!0),x(null);try{const p=await fetch(se,{method:"GET"});if(!p.ok)throw new Error(`HTTP error! status: ${p.status}`);const _=await p.json();if(_.error)throw new Error(_.error);return _}catch(p){return x(p.message),console.error("Помилка завантаження даних:",p),null}finally{m(!1)}},[]),c=v.useCallback(async p=>{m(!0),x(null);try{const _={...p,last:new Date().toISOString(),modified:new Date().toISOString()},l=new URLSearchParams({data:JSON.stringify(_)}),o=await fetch(`${se}?${l}`,{method:"GET"});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const C=await o.json();if(C.error)throw new Error(C.error);return C}catch(_){throw x(_.message),console.error("Помилка збереження даних:",_),_}finally{m(!1)}},[]),d=v.useCallback(()=>new Promise((p,_)=>{const l="apiCallback_"+Date.now(),o=document.createElement("script");window[l]=function(C){p(C),delete window[l],document.head.removeChild(o)},o.onerror=function(){_(new Error("JSONP request failed")),delete window[l],document.head.removeChild(o)},o.src=`${se}?callback=${l}`,document.head.appendChild(o)}),[]);return{loading:t,error:N,loadData:a,saveData:c,loadDataJSONP:d}},_e=t=>t&&t.W!==null&&t.W!==void 0&&t.Kл!==null&&t.Kл!==void 0&&t.силос!==null&&t.силос!==void 0,Zt={силос:1,W:15.5,ЧП:350,Kл:22,ВДК:80,m:10,дата:()=>new Date().toLocaleDateString("uk-UA")},Qt=["1","1a","2","2a","3","3a","4","4a","5","5a","6","6a"],T={MAIN:"main",CALCULATOR:"calc",SELECT:"select"};const es="_app_wmham_1",ts="_header_wmham_8",ss="_editBtn_wmham_22",ns="_calculatorPreview_wmham_37",as="_glutenControls_wmham_47",ls="_disabledControls_wmham_55",os="_calcBtn_wmham_62",rs="_pitsGrid_wmham_77",cs="_loading_wmham_83",H={app:es,header:ts,editBtn:ss,calculatorPreview:ns,glutenControls:as,disabledControls:ls,calcBtn:os,pitsGrid:rs,loading:cs},is=()=>{const[t,m]=v.useState([]),[N,x]=v.useState([]),[a,c]=v.useState(T.MAIN),{loading:d,error:p,loadData:_,saveData:l}=Xt();v.useEffect(()=>{o()},[]);const o=async()=>{const w=await _(),b=Qt.map(E=>({id:E,силос:null,W:null,ЧП:null,Kл:null,ВДК:null,m:null,дата:Zt.дата()}));w&&w.pits&&Array.isArray(w.pits)&&w.pits.forEach(E=>{const M=b.findIndex($=>$.id===E.id);M!==-1&&(b[M]={...b[M],...E})}),m(b)},C=async w=>{try{const b=w.filter(E=>_e(E));await l({pits:b}),m(w)}catch(b){console.error("Помилка збереження:",b)}},D=w=>{_e(w)&&x(b=>{const E=b.some($=>$.id===w.id);let M;return E?M=b.filter($=>$.id!==w.id):M=[...b,w],M.length>0?c(T.CALCULATOR):c(T.MAIN),M})},U=()=>{c(T.MAIN),x([])},K=()=>{c(T.SELECT)};return d&&t.length===0?e.jsxs("div",{className:H.loading,children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("span",{children:"Завантаження..."})]}):a===T.CALCULATOR?e.jsx(It,{selectedPits:N,allPits:t,onPitSelect:D,onBack:U}):a===T.SELECT?e.jsx(Yt,{pits:t,onBack:U,onSave:C}):e.jsxs("div",{className:H.app,children:[e.jsxs("div",{className:H.header,children:[e.jsx("h1",{children:"LAB Calc"}),e.jsx("button",{onClick:K,className:H.editBtn,"aria-label":"Редагувати ями",children:"📝"})]}),p&&e.jsx("div",{className:H.errorMessage,children:p}),e.jsx("div",{className:H.pitsGrid,children:t.map(w=>e.jsx(ae,{pit:w,isSelected:N.some(b=>b.id===w.id),onSelect:D,mode:"view"},w.id))})]})};window.fetch||console.error("Ваш браузер не підтримує fetch API. Оновіть браузер.");window.addEventListener("error",t=>{console.error("Глобальна помилка:",t.error)});window.addEventListener("unhandledrejection",t=>{console.error("Необроблений промис:",t.reason)});"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(t=>{console.log("SW registered: ",t)}).catch(t=>{console.log("SW registration failed: ",t)})});const ds=ne.createRoot(document.getElementById("root"));ds.render(e.jsx(Re.StrictMode,{children:e.jsx(is,{})}));
