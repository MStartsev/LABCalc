import{r as j,a as Se,R as Me}from"./vendor-b1791c80.js";(function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))x(a);new MutationObserver(a=>{for(const c of a)if(c.type==="childList")for(const d of c.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&x(d)}).observe(document,{childList:!0,subtree:!0});function N(a){const c={};return a.integrity&&(c.integrity=a.integrity),a.referrerPolicy&&(c.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?c.credentials="include":a.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function x(a){if(a.ep)return;a.ep=!0;const c=N(a);fetch(a.href,c)}})();var _e={exports:{}},Q={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Fe=j,Re=Symbol.for("react.element"),Ee=Symbol.for("react.fragment"),De=Object.prototype.hasOwnProperty,$e=Fe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ke={key:!0,ref:!0,__self:!0,__source:!0};function fe(t,u,N){var x,a={},c=null,d=null;N!==void 0&&(c=""+N),u.key!==void 0&&(c=""+u.key),u.ref!==void 0&&(d=u.ref);for(x in u)De.call(u,x)&&!ke.hasOwnProperty(x)&&(a[x]=u[x]);if(t&&t.defaultProps)for(x in u=t.defaultProps,u)a[x]===void 0&&(a[x]=u[x]);return{$$typeof:Re,type:t,key:c,ref:d,props:a,_owner:$e.current}}Q.Fragment=Ee;Q.jsx=fe;Q.jsxs=fe;_e.exports=Q;var e=_e.exports,se={},he=Se;se.createRoot=he.createRoot,se.hydrateRoot=he.hydrateRoot;const Be="_pitCard_5j7hj_1",Ie="_selected_5j7hj_19",Le="_empty_5j7hj_24",Ke="_pitHeader_5j7hj_34",Te="_pitNumber_5j7hj_41",Ae="_pitDate_5j7hj_47",We="_checkbox_5j7hj_52",Ge="_pitContent_5j7hj_63",Pe="_pitRow_5j7hj_70",Oe="_pitCorner_5j7hj_76",S={pitCard:Be,selected:Ie,empty:Le,pitHeader:Ke,pitNumber:Te,pitDate:Ae,checkbox:We,pitContent:Ge,pitRow:Pe,pitCorner:Oe},ne=({pit:t,isSelected:u,onSelect:N,onEdit:x,mode:a="view"})=>{const c=()=>!t.W||!t.Kл||t.силос===null?"var(--color-empty)":t.силос===1?"var(--color-silo-1)":t.силос===2?"var(--color-silo-2)":t.силос===3?parseFloat(t.Kл)>23?"var(--color-silo-3-high)":"var(--color-silo-3-low)":"var(--color-empty)",d=(l,o="")=>l==null||l===""?"-":`${l}${o}`,_=()=>{a==="select"?x(t):a==="view"&&t.W&&t.Kл&&t.силос!==null&&N(t)},p=l=>{l.stopPropagation(),t.W&&t.Kл&&t.силос!==null&&N(t)};return e.jsxs("div",{className:`${S.pitCard} ${u?S.selected:""} ${!t.W||!t.Kл||t.силос===null?S.empty:""}`,style:{backgroundColor:c()},onClick:_,children:[e.jsxs("div",{className:S.pitHeader,children:[e.jsx("span",{className:S.pitNumber,children:t.id}),e.jsx("span",{className:S.pitDate,children:t.дата}),a==="view"&&e.jsx("input",{type:"checkbox",checked:u,onChange:p,disabled:!t.W||!t.Kл||t.силос===null,className:S.checkbox})]}),e.jsxs("div",{className:S.pitContent,children:[e.jsxs("div",{className:S.pitRow,children:["W = ",d(t.W,"%")]}),e.jsxs("div",{className:S.pitRow,children:["ЧП = ",d(t.ЧП,"с")]}),e.jsxs("div",{className:S.pitRow,children:["Kл = ",d(t.Kл,"%")," - ",d(t.ВДК,"од.")]}),e.jsxs("div",{className:S.pitRow,children:["m = ",d(t.m,"т")]})]}),t.силос&&e.jsxs("div",{className:S.pitCorner,children:[t.силос,"с"]})]})},Ve="_calculator_1f636_1",He="_header_1f636_8",Ue="_modeBtn_1f636_21",ze="_filtersRow_1f636_40",Je="_componentFilter_1f636_49",qe="_resultsFilter_1f636_50",Ye="_filterSelect_1f636_64",Xe="_topResultsContainer_1f636_80",Ze="_topResultsTitle_1f636_87",Qe="_topResultItem_1f636_94",et="_selectedResult_1f636_109",tt="_resultHeader_1f636_114",st="_resultNumber_1f636_121",nt="_componentCount_1f636_127",at="_resultData_1f636_136",lt="_resultMix_1f636_142",ot="_errorValue_1f636_148",rt="_errorPulse_1f636_1",ct="_resultPercentages_1f636_193",it="_modeLabel_1f636_198",dt="_disabledBtn_1f636_211",ut="_controlTable_1f636_226",mt="_backBtn_1f636_233",ht="_glutenRow_1f636_253",xt="_mixResult_1f636_263",_t="_mixGrid_1f636_274",ft="_mixItem_1f636_281",pt="_mixLabel_1f636_295",gt="_mixValue_1f636_300",jt="_glutenLabel_1f636_324",vt="_glutenValue_1f636_330",Nt="_pitControlRow_1f636_337",bt="_pitId_1f636_351",Ct="_controlBtn_1f636_357",wt="_percentageValue_1f636_382",yt="_percentageFixed_1f636_392",St="_pitData_1f636_400",Mt="_mixDisplay_1f636_408",Ft="_mixInfo_1f636_416",Rt="_pitsGrid_1f636_424",Et="_pitContainer_1f636_431",n={calculator:Ve,header:He,modeBtn:Ue,filtersRow:ze,componentFilter:Je,resultsFilter:qe,filterSelect:Ye,topResultsContainer:Xe,topResultsTitle:Ze,topResultItem:Qe,selectedResult:et,resultHeader:tt,resultNumber:st,componentCount:nt,resultData:at,resultMix:lt,errorValue:ot,errorPulse:rt,resultPercentages:ct,modeLabel:it,disabledBtn:dt,controlTable:ut,backBtn:mt,glutenRow:ht,mixResult:xt,mixGrid:_t,mixItem:ft,mixLabel:pt,mixValue:gt,glutenLabel:jt,glutenValue:vt,pitControlRow:Nt,pitId:bt,controlBtn:Ct,percentageValue:wt,percentageFixed:yt,pitData:St,mixDisplay:Mt,mixInfo:Ft,pitsGrid:Rt,pitContainer:Et},Dt=({selectedPits:t,onBack:u,allPits:N,onPitSelect:x})=>{const[a,c]=j.useState(null),[d,_]=j.useState({}),[p,l]=j.useState({}),[o,w]=j.useState(!0),[E,U]=j.useState(null),[T,C]=j.useState("best"),[b,D]=j.useState(!1),[M,$]=j.useState([]);j.useEffect(()=>{const s=localStorage.getItem("labcalc_target_gluten");if(s){const m=parseFloat(s);isNaN(m)||U(m)}},[]),j.useEffect(()=>{t.length===1?(_({[t[0].id]:100}),l(t[0]),c(parseFloat(t[0].Kл)),$([])):t.length>=2&&(t.length===0&&E&&!a&&c(E),o?pe():ge())},[t,o,T,E]);const pe=()=>{const s=t.map(y=>parseFloat(y.Kл)).filter(y=>!isNaN(y)),m=Math.min(...s),g=Math.max(...s),h=E||(s.length>0?(m+g)/2:22);c(Math.round(h*10)/10);const r=ae(h,t);b&&r.alternatives&&r.alternatives.length>0?($(r.alternatives),_(r.alternatives[0].percentages),l(r.alternatives[0].mixData)):(_(r.percentages||r),q(r.percentages||r),$([]))},ge=()=>{const s={},m=Math.floor(100/t.length/10)*10;let g=100;t.forEach((h,r)=>{if(r===t.length-1)s[h.id]=Math.max(0,g);else{const y=Math.max(0,m);s[h.id]=y,g-=y}}),_(s),q(s),le(s)},ae=(s,m)=>{if(m.length<2)return{};const g=350;if(m.length===2){const[i,f]=m,k=parseFloat(i.Kл),z=parseFloat(f.Kл);if(Math.abs(k-z)<.01)return{[i.id]:50,[f.id]:50};const R=(s-z)/(k-z)*100,G=100-R;return{[i.id]:Math.max(0,Math.min(100,Math.round(R/10)*10)),[f.id]:Math.max(0,Math.min(100,Math.round(G/10)*10))}}console.log(`Оптимізація для цільової клейковини: ${s}%, цільове число падіння: ${g}с`),console.log(`Фільтр компонентів: ${T}`),console.log("Ями:",m.map(i=>`${i.id}(Kл:${i.Kл}%, ЧП:${i.ЧП}с)`));let h=[],r=1/0;const y=i=>Object.values(i).filter(f=>f>0).length,A=i=>{const f=y(i);switch(T){case"2-comp":return f===2;case"3-comp":return f===3;case"multi-comp":return f>=4;case"best":default:return!0}},F=(i,f,k)=>{if(i>=m.length){if(k===0){if(!A(f))return;const R=y(f);if(R<2)return;let G=0,I=0,L=0,Y=0,X=1/0,P=0;if(m.forEach(O=>{const ue=f[O.id];if(ue>0){const V=ue/100;G+=parseFloat(O.W||0)*V,I+=parseFloat(O.ЧП||0)*V,L+=parseFloat(O.Kл||0)*V,Y+=parseFloat(O.ВДК||0)*V;const me=parseFloat(O.m||0)/V;me>0&&(X=Math.min(X,me)),P+=V}}),P===0)return;G=G/P,I=I/P,L=L/P,Y=Y/P;const J=Math.abs(L-s),ie=Math.abs(I-g),de={W:Math.round(G*10)/10,ЧП:Math.round(I),Kл:Math.round(L*10)/10,ВДК:Math.round(Y),m:X===1/0?0:Math.round(X*10)/10};J<r-.049?(r=J,h=[{percentages:{...f},glutenError:J,fallingNumberError:ie,mixGluten:L,mixFallingNumber:I,mixData:de,componentCount:R}]):Math.abs(J-r)<=.049&&h.push({percentages:{...f},glutenError:J,fallingNumberError:ie,mixGluten:L,mixFallingNumber:I,mixData:de,componentCount:R})}return}const z=m[i];for(let R=0;R<=Math.min(100,k);R+=10)f[z.id]=R,F(i+1,f,k-R)};console.log("Початок повного перебору комбінацій...");const W=Date.now();F(0,{},100);const B=Date.now();if(console.log(`Перебір завершено за ${B-W}мс`),h.length===0)return console.log("Не знайдено валідних комбінацій, використовуємо запасний варіант"),{percentages:m.reduce((i,f,k)=>(i[f.id]=k===0?100:0,i),{})};if(h.sort((i,f)=>i.fallingNumberError-f.fallingNumberError),console.log(`Знайдено ${h.length} комбінацій з помилкою клейковини ≤ ${r.toFixed(3)}`),b){const i=h.slice(0,5);return console.log("Топ 5 результатів:"),i.forEach((f,k)=>{console.log(`${k+1}. ${f.componentCount}-комп: Kл:${f.mixGluten.toFixed(1)}% ЧП:${f.mixFallingNumber.toFixed(0)}с W:${f.mixData.W}% m:${f.mixData.m}т`),console.log(`   Відсотки: ${JSON.stringify(f.percentages)}`)}),{percentages:i[0].percentages,alternatives:i}}else{const i=h[0];return console.log("Обрана найкраща комбінація:"),console.log(`  ${i.componentCount}-компонентна суміш`),console.log(`  Клейковина: ${i.mixGluten.toFixed(1)}% (помилка: ${i.glutenError.toFixed(3)})`),console.log(`  Число падіння: ${i.mixFallingNumber.toFixed(0)}с (помилка: ${i.fallingNumberError.toFixed(1)})`),console.log("  Повні дані суміші:",i.mixData),console.log("  Відсотки:",i.percentages),{percentages:i.percentages}}},q=s=>{if(Object.values(s).reduce((F,W)=>F+(W||0),0)===0)return;let g=0,h=0,r=0,y=0,A=1/0;t.forEach(F=>{const W=s[F.id]||0;if(W>0){const B=W/100;g+=parseFloat(F.W||0)*B,h+=parseFloat(F.ЧП||0)*B,r+=parseFloat(F.Kл||0)*B,y+=parseFloat(F.ВДК||0)*B;const i=parseFloat(F.m||0)/B;i>0&&(A=Math.min(A,i))}}),l({W:Math.round(g*10)/10,ЧП:Math.round(h),Kл:Math.round(r*10)/10,ВДК:Math.round(y),m:A===1/0?0:Math.round(A*10)/10})},le=s=>{let m=0,g=0;if(t.forEach(h=>{const r=s[h.id]||0;r>0&&(m+=parseFloat(h.Kл||0)*(r/100),g+=r/100)}),g>0){const h=m/g;c(Math.round(h*10)/10)}},oe=s=>{if(t.length<2)return;const m=t.map(y=>parseFloat(y.Kл));Math.min(...m),Math.max(...m);const g=a+s,h=Math.round(g*10)/10;c(h),U(h),localStorage.setItem("labcalc_target_gluten",h.toString());const r=ae(h,t);b&&r.alternatives&&r.alternatives.length>0?($(r.alternatives),_(r.alternatives[0].percentages),l(r.alternatives[0].mixData)):(_(r.percentages||r),q(r.percentages||r))},re=(s,m)=>{const g={...d};let r=(g[s]||0)+m;r=Math.max(0,Math.min(100,Math.round(r/10)*10)),g[s]=r,_(g),q(g),le(g)},je=()=>{w(!o)},ve=()=>o&&t.length>=2,Ne=()=>o&&t.length>=2,be=s=>!o&&(d[s]||0)>0,Ce=s=>!o&&(d[s]||0)<100,ee=()=>Object.values(d).reduce((s,m)=>s+(m||0),0),ce=()=>!o&&ee()>100||!o&&ee()<100,we=()=>!p.Kл||!a?0:Math.abs(p.Kл-a),ye=()=>o&&we()>.5;return t.length>=2,t.length>=2,e.jsxs("div",{className:n.calculator,children:[e.jsxs("div",{className:n.header,children:[e.jsx("button",{onClick:u,className:n.backBtn,children:"←"}),e.jsx("h2",{children:"LAB Calc"}),e.jsx("button",{onClick:je,className:n.modeBtn,children:o?"🤖":"✋"})]}),e.jsxs("div",{className:n.controlTable,children:[e.jsxs("div",{className:n.glutenRow,children:[e.jsx("span",{className:n.glutenLabel,children:"Кл"}),o?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>oe(-.1),className:n.controlBtn,disabled:!ve(),children:"-"}),e.jsxs("span",{className:`${n.glutenValue} ${ye()?n.errorValue:""}`,children:[(a==null?void 0:a.toFixed(1))||"0.0","%"]}),e.jsx("button",{onClick:()=>oe(.1),className:n.controlBtn,disabled:!Ne(),children:"+"})]}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:n.disabledBtn,children:"-"}),e.jsxs("span",{className:n.glutenValue,children:[(a==null?void 0:a.toFixed(1))||"0.0","%"]}),e.jsx("span",{className:n.disabledBtn,children:"+"})]}),e.jsxs("div",{className:n.modeLabel,children:[o?"АВТО":"РУЧН",!o&&ce()&&e.jsxs("div",{className:n.totalPercentage,children:[ee(),"%"]})]})]}),e.jsx("div",{className:n.mixInfo,children:e.jsxs("div",{className:n.mixGrid,children:[e.jsxs("div",{className:n.mixItem,children:[e.jsx("span",{className:n.mixLabel,children:"W:"}),e.jsxs("span",{className:n.mixValue,children:[p.W||0,"%"]})]}),e.jsxs("div",{className:n.mixItem,children:[e.jsx("span",{className:n.mixLabel,children:"ЧП:"}),e.jsxs("span",{className:n.mixValue,children:[p.ЧП||0,"с"]})]}),e.jsxs("div",{className:n.mixItem,children:[e.jsx("span",{className:n.mixLabel,children:"Kл:"}),e.jsxs("span",{className:n.mixValue,children:[p.Kл||0,"%"]})]}),e.jsxs("div",{className:n.mixItem,children:[e.jsx("span",{className:n.mixLabel,children:"ВДК:"}),e.jsxs("span",{className:n.mixValue,children:[p.ВДК||0,"од."]})]}),e.jsxs("div",{className:n.mixItem,children:[e.jsx("span",{className:n.mixLabel,children:"m:"}),e.jsxs("span",{className:n.mixValue,children:[p.m||0,"т"]})]})]})}),o&&t.length>2&&e.jsxs("div",{className:n.filtersRow,children:[e.jsxs("div",{className:n.componentFilter,children:[e.jsx("label",{children:"Компоненти:"}),e.jsxs("select",{value:T,onChange:s=>C(s.target.value),className:n.filterSelect,children:[e.jsx("option",{value:"best",children:"Найкращий"}),e.jsx("option",{value:"2-comp",children:"2-компонентні"}),e.jsx("option",{value:"3-comp",children:"3-компонентні"}),t.length>3&&e.jsx("option",{value:"multi-comp",children:"Багато-компонентні"})]})]}),e.jsxs("div",{className:n.resultsFilter,children:[e.jsx("label",{children:"Показати:"}),e.jsxs("select",{value:b?"top5":"best",onChange:s=>D(s.target.value==="top5"),className:n.filterSelect,children:[e.jsx("option",{value:"best",children:"Найкращий варіант"}),e.jsx("option",{value:"top5",children:"Топ 5 варіантів"})]})]})]}),t.filter(s=>(d[s.id]||0)>0).map(s=>e.jsxs("div",{className:n.pitControlRow,children:[e.jsx("span",{className:n.pitId,children:s.id}),t.length===1?e.jsx("span",{className:n.percentageFixed,children:"100%"}):o?e.jsxs("span",{className:n.percentageFixed,children:[d[s.id]||0,"%"]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>re(s.id,-10),className:n.controlBtn,disabled:!be(s.id),children:"-"}),e.jsxs("span",{className:`${n.percentageValue} ${ce()?n.errorValue:""}`,children:[d[s.id]||0,"%"]}),e.jsx("button",{onClick:()=>re(s.id,10),className:n.controlBtn,disabled:!Ce(s.id),children:"+"})]})]},s.id))]}),o&&b&&M.length>0&&e.jsxs("div",{className:n.topResultsContainer,children:[e.jsxs("h3",{className:n.topResultsTitle,children:["Топ ",M.length," варіантів:"]}),M.map((s,m)=>e.jsxs("div",{className:`${n.topResultItem} ${m===0?n.selectedResult:""}`,onClick:()=>{_(s.percentages),l(s.mixData)},children:[e.jsxs("div",{className:n.resultHeader,children:[e.jsxs("span",{className:n.resultNumber,children:["#",m+1]}),e.jsxs("span",{className:n.componentCount,children:[s.componentCount,"-комп"]})]}),e.jsxs("div",{className:n.resultData,children:[e.jsxs("div",{className:n.resultMix,children:["W = ",s.mixData.W,"% | ЧП = ",s.mixData.ЧП,"с | Kл ="," ",s.mixData.Kл,"% | m = ",s.mixData.m,"т"]}),e.jsx("div",{className:n.resultPercentages,children:Object.entries(s.percentages).filter(([g,h])=>h>0).map(([g,h])=>`${g}:${h}%`).join(", ")})]})]},m))]}),e.jsx("div",{className:n.pitsGrid,children:N.map(s=>{const m=t.some(g=>g.id===s.id);return e.jsx("div",{className:n.pitContainer,children:e.jsx(ne,{pit:s,isSelected:m,onSelect:x,mode:"view"})},s.id)})})]})},$t="_modalOverlay_1xuyf_1",kt="_modal_1xuyf_1",Bt="_modalHeader_1xuyf_58",It="_backBtn_1xuyf_72",Lt="_formFields_1xuyf_87",Kt="_field_1xuyf_94",Tt="_input_1xuyf_106",At="_select_1xuyf_107",Wt="_modalActions_1xuyf_124",Gt="_clearBtn_1xuyf_131",Pt="_saveBtn_1xuyf_147",v={modalOverlay:$t,modal:kt,modalHeader:Bt,backBtn:It,formFields:Lt,field:Kt,input:Tt,select:At,modalActions:Wt,clearBtn:Gt,saveBtn:Pt},Ot=({pit:t,isOpen:u,onClose:N,onSave:x})=>{const[a,c]=j.useState({силос:2,W:15.6,ЧП:360,Kл:22,ВДК:80,m:10,дата:new Date().toLocaleDateString("uk-UA")});j.useEffect(()=>{t&&u&&c({силос:t.силос||2,W:t.W||15.6,ЧП:t.ЧП||360,Kл:t.Kл||22,ВДК:t.ВДК||80,m:t.m||10,дата:t.дата||new Date().toLocaleDateString("uk-UA")})},[t,u]);const d=(l,o)=>{c(w=>({...w,[l]:o}))},_=()=>{const l={...t,...a};x(l),N()},p=()=>{const l={...t,силос:null,W:null,ЧП:null,Kл:null,ВДК:null,m:null};x(l),N()};return!u||!t?null:e.jsx("div",{className:v.modalOverlay,onClick:N,children:e.jsxs("div",{className:v.modal,onClick:l=>l.stopPropagation(),children:[e.jsxs("div",{className:v.modalHeader,children:[e.jsx("button",{onClick:N,className:v.backBtn,children:"←"}),e.jsx("h3",{children:t.id}),e.jsx("div",{})]}),e.jsxs("div",{className:v.formFields,children:[e.jsxs("div",{className:v.field,children:[e.jsx("label",{children:"Силос"}),e.jsxs("select",{value:a.силос||2,onChange:l=>d("силос",parseInt(l.target.value)),className:v.select,children:[e.jsx("option",{value:1,children:"1"}),e.jsx("option",{value:2,children:"2"}),e.jsx("option",{value:3,children:"3"})]})]}),e.jsxs("div",{className:v.field,children:[e.jsx("label",{children:"W"}),e.jsx("input",{type:"number",step:"0.1",value:a.W||"",onChange:l=>d("W",parseFloat(l.target.value)||null),className:v.input})]}),e.jsxs("div",{className:v.field,children:[e.jsx("label",{children:"ЧП"}),e.jsx("input",{type:"number",step:"1",value:a.ЧП||"",onChange:l=>d("ЧП",parseInt(l.target.value)||null),className:v.input})]}),e.jsxs("div",{className:v.field,children:[e.jsx("label",{children:"Kл"}),e.jsx("input",{type:"number",step:"0.1",value:a.Kл||"",onChange:l=>d("Kл",parseFloat(l.target.value)||null),className:v.input})]}),e.jsxs("div",{className:v.field,children:[e.jsx("label",{children:"ВДК"}),e.jsx("input",{type:"number",step:"1",value:a.ВДК||"",onChange:l=>d("ВДК",parseInt(l.target.value)||null),className:v.input})]}),e.jsxs("div",{className:v.field,children:[e.jsx("label",{children:"m"}),e.jsx("input",{type:"number",step:"0.1",value:a.m||"",onChange:l=>d("m",parseFloat(l.target.value)||null),className:v.input})]}),e.jsxs("div",{className:v.field,children:[e.jsx("label",{children:"дата"}),e.jsx("input",{type:"text",value:a.дата||"",onChange:l=>d("дата",l.target.value),className:v.input})]})]}),e.jsxs("div",{className:v.modalActions,children:[e.jsx("button",{onClick:p,className:v.clearBtn,children:"Очистити"}),e.jsx("button",{onClick:_,className:v.saveBtn,children:"Зберегти"})]})]})})},Vt="_selectMode_10oum_1",Ht="_header_10oum_7",Ut="_backBtn_10oum_21",zt="_pitsGrid_10oum_41",Z={selectMode:Vt,header:Ht,backBtn:Ut,pitsGrid:zt},Jt=({pits:t,onBack:u,onSave:N})=>{const[x,a]=j.useState(null),[c,d]=j.useState(t),_=async o=>{const w=c.map(E=>E.id===o.id?o:E);d(w),await N(w)},p=o=>{a(o)},l=()=>{a(null)};return e.jsxs("div",{className:Z.selectMode,children:[e.jsxs("div",{className:Z.header,children:[e.jsx("button",{onClick:u,className:Z.backBtn,children:"←"}),e.jsx("h2",{children:"Внести зміни"}),e.jsx("div",{})]}),e.jsx("div",{className:Z.pitsGrid,children:c.map(o=>e.jsx(ne,{pit:o,isSelected:!1,onSelect:()=>{},onEdit:p,mode:"select"},o.id))}),e.jsx(Ot,{pit:x,isOpen:!!x,onClose:l,onSave:_})]})},te="https://script.google.com/macros/s/AKfycbyb3E1Nuc9giNSY0zuhu7hcPYGWILYoO7X8X0DWG9DTASEzfIWmKM4JxS4FwzdyGwKS/exec",qt=()=>{const[t,u]=j.useState(!1),[N,x]=j.useState(null),a=j.useCallback(async()=>{u(!0),x(null);try{const _=await fetch(te,{method:"GET"});if(!_.ok)throw new Error(`HTTP error! status: ${_.status}`);const p=await _.json();if(p.error)throw new Error(p.error);return p}catch(_){return x(_.message),console.error("Помилка завантаження даних:",_),null}finally{u(!1)}},[]),c=j.useCallback(async _=>{u(!0),x(null);try{const p={..._,last:new Date().toISOString(),modified:new Date().toISOString()},l=new URLSearchParams({data:JSON.stringify(p)}),o=await fetch(`${te}?${l}`,{method:"GET"});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const w=await o.json();if(w.error)throw new Error(w.error);return w}catch(p){throw x(p.message),console.error("Помилка збереження даних:",p),p}finally{u(!1)}},[]),d=j.useCallback(()=>new Promise((_,p)=>{const l="apiCallback_"+Date.now(),o=document.createElement("script");window[l]=function(w){_(w),delete window[l],document.head.removeChild(o)},o.onerror=function(){p(new Error("JSONP request failed")),delete window[l],document.head.removeChild(o)},o.src=`${te}?callback=${l}`,document.head.appendChild(o)}),[]);return{loading:t,error:N,loadData:a,saveData:c,loadDataJSONP:d}},xe=t=>t&&t.W!==null&&t.W!==void 0&&t.Kл!==null&&t.Kл!==void 0&&t.силос!==null&&t.силос!==void 0,Yt={силос:1,W:15.5,ЧП:350,Kл:22,ВДК:80,m:10,дата:()=>new Date().toLocaleDateString("uk-UA")},Xt=["1","1a","2","2a","3","3a","4","4a","5","5a","6","6a"],K={MAIN:"main",CALCULATOR:"calc",SELECT:"select"};const Zt="_app_wmham_1",Qt="_header_wmham_8",es="_editBtn_wmham_22",ts="_calculatorPreview_wmham_37",ss="_glutenControls_wmham_47",ns="_disabledControls_wmham_55",as="_calcBtn_wmham_62",ls="_pitsGrid_wmham_77",os="_loading_wmham_83",H={app:Zt,header:Qt,editBtn:es,calculatorPreview:ts,glutenControls:ss,disabledControls:ns,calcBtn:as,pitsGrid:ls,loading:os},rs=()=>{const[t,u]=j.useState([]),[N,x]=j.useState([]),[a,c]=j.useState(K.MAIN),{loading:d,error:_,loadData:p,saveData:l}=qt();j.useEffect(()=>{o()},[]);const o=async()=>{const C=await p(),b=Xt.map(D=>({id:D,силос:null,W:null,ЧП:null,Kл:null,ВДК:null,m:null,дата:Yt.дата()}));C&&C.pits&&Array.isArray(C.pits)&&C.pits.forEach(D=>{const M=b.findIndex($=>$.id===D.id);M!==-1&&(b[M]={...b[M],...D})}),u(b)},w=async C=>{try{const b=C.filter(D=>xe(D));await l({pits:b}),u(C)}catch(b){console.error("Помилка збереження:",b)}},E=C=>{xe(C)&&x(b=>{const D=b.some($=>$.id===C.id);let M;return D?M=b.filter($=>$.id!==C.id):M=[...b,C],M.length>0?c(K.CALCULATOR):c(K.MAIN),M})},U=()=>{c(K.MAIN),x([])},T=()=>{c(K.SELECT)};return d&&t.length===0?e.jsxs("div",{className:H.loading,children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("span",{children:"Завантаження..."})]}):a===K.CALCULATOR?e.jsx(Dt,{selectedPits:N,allPits:t,onPitSelect:E,onBack:U}):a===K.SELECT?e.jsx(Jt,{pits:t,onBack:U,onSave:w}):e.jsxs("div",{className:H.app,children:[e.jsxs("div",{className:H.header,children:[e.jsx("h1",{children:"LAB Calc"}),e.jsx("button",{onClick:T,className:H.editBtn,"aria-label":"Редагувати ями",children:"✏️"})]}),_&&e.jsx("div",{className:H.errorMessage,children:_}),e.jsx("div",{className:H.pitsGrid,children:t.map(C=>e.jsx(ne,{pit:C,isSelected:N.some(b=>b.id===C.id),onSelect:E,mode:"view"},C.id))})]})};window.fetch||console.error("Ваш браузер не підтримує fetch API. Оновіть браузер.");window.addEventListener("error",t=>{console.error("Глобальна помилка:",t.error)});window.addEventListener("unhandledrejection",t=>{console.error("Необроблений промис:",t.reason)});"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").then(t=>{console.log("SW registered: ",t)}).catch(t=>{console.log("SW registration failed: ",t)})});const cs=se.createRoot(document.getElementById("root"));cs.render(e.jsx(Me.StrictMode,{children:e.jsx(rs,{})}));
//# sourceMappingURL=index-6d1e2aea.js.map
